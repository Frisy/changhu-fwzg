<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>看板管理 - 居家长护业务管理系统</title>
  <!-- 引入外部资源 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <style>
    /* 继承全局样式 */
    body { font-family: "微软雅黑", "思源黑体", sans-serif; background-color: #f5f7fa; color: #333; }
    .btn-primary { background-color: #1890FF; border-color: #1890FF; }
    .btn-primary:hover { background-color: #096DD9; border-color: #096DD9; }
    .btn-outline-secondary { border-color: #ddd; color: #666; }
    .btn-outline-secondary:hover { background-color: #f5f5f5; border-color: #ccc; }
    .card { border: none; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 20px; }
    .card-header { background: #fff; border-bottom: 1px solid #f0f0f0; border-radius: 12px 12px 0 0; padding: 15px 20px; font-weight: 600; font-size: 15px; }
    .card-body { padding: 20px; }
    /* 布局样式 */
    .app-container { display: flex; min-height: 100vh; }
    /* 侧边导航 */
    .sidebar { width: 220px; background: #fff; box-shadow: 1px 0 2px rgba(0,0,0,0.05); padding: 20px 0; flex-shrink: 0; }
    .sidebar-logo { text-align: center; padding: 0 20px 20px; border-bottom: 1px solid #f0f0f0; margin-bottom: 20px; }
    .sidebar-logo img { height: 40px; margin-bottom: 8px; }
    .sidebar-logo h3 { font-size: 16px; color: #1890FF; font-weight: 600; margin: 0; }
    .nav-menu { list-style: none; padding: 0; margin: 0; }
    .nav-item { margin-bottom: 4px; }
    .nav-link { display: flex; align-items: center; padding: 12px 20px; color: #666; text-decoration: none; font-size: 14px; border-left: 3px solid transparent; }
    .nav-link:hover, .nav-link.active { color: #1890FF; background-color: #f0f7ff; border-left: 3px solid #1890FF; }
    .nav-link i { font-size: 18px; margin-right: 12px; width: 20px; text-align: center; }
    .nav-group-title { padding: 15px 20px 5px; font-size: 12px; color: #999; font-weight: 500; }
    /* 主内容区 */
    .main-content { flex: 1; padding: 20px; overflow-y: auto; }
    /* 顶部导航 */
    .top-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .page-title { font-size: 20px; font-weight: 600; color: #333; margin: 0; }
    .user-info { display: flex; align-items: center; }
    .notification { position: relative; margin-right: 20px; cursor: pointer; }
    .notification i { font-size: 20px; color: #666; }
    .notification-badge { position: absolute; top: -5px; right: -5px; width: 18px; height: 18px; background: #FF4D4F; color: #fff; border-radius: 50%; font-size: 12px; text-align: center; line-height: 18px; }
    .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: #1890FF; color: #fff; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 600; margin-right: 10px; }
    .user-name { font-size: 14px; font-weight: 500; }

    /* 看板页面专属样式 */
    /* 通用顶部筛选栏 */
    .kanban-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: #fff; border-radius: 8px; margin-bottom: 20px; }
    .month-selector { display: flex; align-items: center; gap: 10px; }
    .month-selector label { font-weight: 500; margin: 0; }
    .header-actions { display: flex; gap: 10px; }
    .filter-btn, .refresh-btn { padding: 6px 15px; border-radius: 6px; font-size: 14px; }
    
    /* 标签页样式 */
    .kanban-tabs .nav-link { border: 1px solid transparent; border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem; color: #666; }
    .kanban-tabs .nav-link.active { color: #1890FF; background-color: #fff; border-color: #dee2e6 #dee2e6 #fff; border-top: 3px solid #1890FF; font-weight: 500; }
    .kanban-content { background: #fff; border-radius: 0 0 8px 8px; padding: 20px; min-height: 600px; }
    
    /* 服务对象看板样式 */
    .obj-kanban-layout { display: flex; flex-direction: column; gap: 15px; height: 100%; }
    .obj-table-container { overflow-x: auto; overflow-y: auto; max-height: 600px; position: relative; }
    .obj-table { width: 100%; border-collapse: collapse; min-width: 1800px; }
    .obj-table th, .obj-table td { border: 1px solid #f0f0f0; padding: 8px 10px; text-align: center; font-size: 13px; white-space: nowrap; }
    .obj-table th { background-color: #f8f9fa; font-weight: 500; position: sticky; top: 0; z-index: 10; }
    .obj-table th:first-child, .obj-table td:first-child { position: sticky; left: 0; background-color: #fff; z-index: 5; }
    .obj-table th:nth-child(2), .obj-table td:nth-child(2) { position: sticky; left: 100px; background-color: #fff; z-index: 5; }
    .obj-table th:nth-child(3), .obj-table td:nth-child(3) { position: sticky; left: 150px; background-color: #fff; z-index: 5; }
    .obj-table th:nth-child(4), .obj-table td:nth-child(4) { position: sticky; left: 195px; background-color: #fff; z-index: 5; }
    .obj-table tbody tr:hover { background-color: #f9f9f9; }
    .obj-name-green { color: #52C41A; font-weight: 500; }
    .obj-name-orange { color: #FA8C16; font-weight: 500; }
    .status-col-1 { background-color: #52C41A; color: #fff; }
    .status-col-2 { background-color: #FAAD14; color: #fff; }
    .status-col-3 { background-color: #1890FF; color: #fff; }
    .status-col-30 { background-color: #d9d9d9; color: #333; }
    .status-col-default { background-color: #f5f5f5; color: #333; }
    .summary-red { color: #FF4D4F; font-weight: 600; }
    
    /* 服务不足突出显示 */
    .obj-table tbody tr.service-insufficient {
      background-color: #FFF1F0 !important;
      border-left: 4px solid #FF4D4F;
    }
    .obj-table tbody tr.service-insufficient:hover {
      background-color: #FFE7E5 !important;
    }
    .obj-table tbody tr.service-insufficient td:first-child {
      background-color: #FFF1F0 !important;
    }
    .obj-table tbody tr.service-insufficient td:nth-child(2),
    .obj-table tbody tr.service-insufficient td:nth-child(3),
    .obj-table tbody tr.service-insufficient td:nth-child(4) {
      background-color: #FFF1F0 !important;
    }
    .service-insufficient-badge {
      display: inline-block;
      padding: 2px 6px;
      background-color: #FF4D4F;
      color: #fff;
      border-radius: 3px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 5px;
    }
    
    /* 地址显示优化 */
    .obj-address-cell { position: relative; max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; cursor: help; }
    .obj-address-full { display: none; position: absolute; top: 100%; left: 0; background: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 8px; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15); white-space: normal; min-width: 200px; font-size: 12px; }
    .obj-address-cell:hover .obj-address-full { display: block; }
    
    /* 全屏显示样式 */
    .obj-kanban-fullscreen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 9999; background: #fff; padding: 20px; }
    .obj-kanban-fullscreen .obj-table-container { max-height: calc(100vh - 180px); }
    .obj-kanban-fullscreen .obj-table { min-width: auto; }
    
    /* 操作栏样式 */
    .obj-action-bar {
      position: sticky;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-top: 2px solid #1890FF;
      padding: 15px 20px;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
      z-index: 100;
      display: none;
    }
    .obj-action-bar.show {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .obj-action-bar .selected-info {
      flex: 1;
      font-weight: 500;
      color: #333;
    }
    .obj-action-bar .action-buttons {
      display: flex;
      gap: 10px;
    }
    .obj-table tbody tr.selected {
      background-color: #e6f7ff !important;
    }
    .obj-table tbody tr {
      cursor: pointer;
    }
    
    /* 筛选和排序控制栏 */
    .obj-controls { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; }
    .obj-controls-left { display: flex; gap: 10px; align-items: center; }
    .obj-controls-right { display: flex; gap: 10px; align-items: center; }
    .sort-select { min-width: 150px; }
    
    /* 自动轮播控制 */
    .carousel-controls { display: flex; align-items: center; gap: 10px; }
    .carousel-btn { padding: 4px 12px; font-size: 12px; }
    .carousel-indicator { font-size: 12px; color: #666; }

    /* 护理员看板样式 */
    .caregiver-kanban-layout { display: flex; flex-direction: column; gap: 15px; height: 100%; }
    .caregiver-table-container { overflow-x: auto; overflow-y: auto; max-height: 600px; position: relative; }
    .caregiver-table { width: 100%; border-collapse: collapse; min-width: 1200px; }
    .caregiver-table th, .caregiver-table td { border: 1px solid #f0f0f0; padding: 6px 8px; text-align: center; font-size: 12px; }
    .caregiver-table th { background-color: #f8f9fa; font-weight: 500; position: sticky; top: 0; z-index: 10; }
    .caregiver-table th:first-child, .caregiver-table td:first-child { position: sticky; left: 0; background-color: #fff; z-index: 5; min-width: 100px; }
    .caregiver-table tbody tr:hover { background-color: #f9f9f9; }
    .caregiver-table td { position: relative; }
    .caregiver-day-cell { cursor: pointer; }
    .caregiver-day-cell:hover { background-color: #e6f7ff !important; }
    
    /* 护理员日期单元格内容 */
    .caregiver-day-content { display: flex; flex-direction: column; gap: 2px; }
    .caregiver-day-item { padding: 2px 4px; border-radius: 3px; font-size: 11px; text-align: center; min-width: 30px; }
    .caregiver-day-item.bill-num { background-color: #E6F7FF; color: #1890FF; font-weight: 600; }
    .caregiver-day-item.plan-hour { background-color: #F6FFED; color: #52C41A; }
    .caregiver-day-item.work-hour { background-color: #FFF7E6; color: #FA8C16; }
    
    /* 图例样式 */
    .caregiver-legend { display: flex; align-items: center; gap: 15px; }
    .legend-label { font-weight: 500; color: #333; }
    .legend-item { display: flex; align-items: center; gap: 6px; }
    .legend-color { width: 20px; height: 16px; border-radius: 3px; display: inline-block; }
    .legend-color.bill-num { background-color: #E6F7FF; }
    .legend-color.plan-hour { background-color: #F6FFED; }
    .legend-color.work-hour { background-color: #FFF7E6; }
    .legend-text { font-size: 12px; color: #666; }
    
    /* 全屏显示样式 */
    .caregiver-kanban-fullscreen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 9999; background: #fff; padding: 20px; }
    .caregiver-kanban-fullscreen .caregiver-table-container { max-height: calc(100vh - 180px); }
    .caregiver-kanban-fullscreen .caregiver-table { min-width: auto; }
    
    /* 护理员操作栏样式 */
    .caregiver-action-bar {
      position: sticky;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-top: 2px solid #1890FF;
      padding: 15px 20px;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
      z-index: 100;
      display: none;
    }
    .caregiver-action-bar.show {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .caregiver-action-bar .selected-info {
      flex: 1;
      font-weight: 500;
      color: #333;
    }
    .caregiver-action-bar .action-buttons {
      display: flex;
      gap: 10px;
    }
    .caregiver-table tbody tr.caregiver-main-row.selected {
      background-color: #e6f7ff !important;
    }
    .caregiver-table tbody tr.caregiver-main-row {
      cursor: pointer;
    }
    
    /* 护理员行展开按钮 */
    .caregiver-expand-btn { color: #1890FF; cursor: pointer; font-size: 12px; }
    .caregiver-expand-btn:hover { text-decoration: underline; }
    
    /* 服务对象详情行（隐藏） */
    .caregiver-obj-detail-row { display: none; background-color: #fafafa; }
    .caregiver-obj-detail-row.show { display: table-row; }
    .caregiver-obj-detail-row td { padding: 10px; text-align: left; }
    .caregiver-obj-detail-table { width: 100%; border-collapse: collapse; font-size: 12px; }
    .caregiver-obj-detail-table th, .caregiver-obj-detail-table td { border: 1px solid #e8e8e8; padding: 6px 8px; text-align: left; }
    .caregiver-obj-detail-table th { background-color: #f0f0f0; font-weight: 500; }
    .caregiver-obj-detail-table .status-normal { color: #52C41A; }
    .caregiver-obj-detail-table .status-pause { color: #FAAD14; }
    .caregiver-obj-detail-table .status-stop { color: #FF4D4F; }
    
    /* 悬停提示框 */
    .caregiver-tooltip { display: none; position: fixed; background: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 12px; width: 350px; z-index: 10003 !important; box-shadow: 0 4px 12px rgba(0,0,0,0.15); font-size: 12px; max-height: 400px; overflow-y: auto; pointer-events: auto; }
    .caregiver-tooltip.show { display: block; }
    .caregiver-tooltip-title { font-weight: 600; color: #1890FF; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #f0f0f0; }
    .caregiver-tooltip-item { margin-bottom: 6px; padding: 8px; background: #f9f9f9; border-radius: 3px; }
    .caregiver-tooltip-item-row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    .caregiver-tooltip-item-name { font-weight: 600; color: #1890FF; }
    .caregiver-tooltip-item-name a { color: #1890FF; text-decoration: none; margin-left: 8px; }
    .caregiver-tooltip-item-name a:hover { text-decoration: underline; }
    .caregiver-tooltip-item-detail { font-size: 11px; color: #666; }
    .caregiver-tooltip-item-detail span { margin-right: 10px; }

    /* 派单信息样式 */
    .operation-kanban-layout { display: flex; flex-direction: column; gap: 20px; height: 100%; }
    
    /* 日派单样式 - 表格形式（先行后列） */
    .daily-dispatch-container { background: #fff; border-radius: 8px; padding: 15px; }
    .daily-dispatch-table { width: 100%; border-collapse: collapse; font-size: 13px; }
    .daily-dispatch-table th, .daily-dispatch-table td { border: 1px solid #e8e8e8; padding: 10px; text-align: left; vertical-align: top; }
    .daily-dispatch-table th { background-color: #f0f0f0; font-weight: 600; color: #333; position: sticky; top: 0; z-index: 5; }
    .daily-dispatch-table th:first-child { background-color: #1890FF; color: #fff; min-width: 120px; }
    .daily-dispatch-table td:first-child { background-color: #f8f9fa; font-weight: 600; color: #1890FF; min-width: 120px; }
    .daily-dispatch-cell { min-width: 200px; max-width: 250px; }
    .daily-dispatch-item { padding: 6px 8px; margin-bottom: 6px; background: #f0f7ff; border-left: 3px solid #1890FF; border-radius: 3px; font-size: 12px; }
    .daily-dispatch-item-name { font-weight: 500; color: #333; margin-bottom: 3px; }
    .daily-dispatch-item-time { color: #666; font-size: 11px; }
    .daily-dispatch-item-package { color: #1890FF; font-size: 11px; margin-top: 2px; }
    
    /* 月派单样式 - 表格形式（先行后列） */
    .monthly-dispatch-container { background: #fff; border-radius: 8px; padding: 15px; }
    .monthly-dispatch-table { width: 100%; border-collapse: collapse; font-size: 13px; }
    .monthly-dispatch-table th, .monthly-dispatch-table td { border: 1px solid #e8e8e8; padding: 10px; text-align: left; vertical-align: top; }
    .monthly-dispatch-table th { background-color: #f0f0f0; font-weight: 600; color: #333; position: sticky; top: 0; z-index: 5; }
    .monthly-dispatch-table th:first-child { background-color: #52C41A; color: #fff; min-width: 80px; }
    .monthly-dispatch-table td:first-child { background-color: #f8f9fa; font-weight: 600; color: #52C41A; min-width: 80px; text-align: center; }
    .monthly-dispatch-cell { min-width: 200px; max-width: 250px; }
    .monthly-dispatch-item { padding: 6px 8px; margin-bottom: 6px; background: #f6ffed; border-left: 3px solid #52C41A; border-radius: 3px; font-size: 12px; }
    .monthly-dispatch-item-name { font-weight: 500; color: #333; margin-bottom: 3px; }
    .monthly-dispatch-item-time { color: #666; font-size: 11px; }
    .monthly-dispatch-item-package { color: #1890FF; font-size: 11px; margin-top: 2px; }
    
    /* 筛选条件区域 */
    .operation-filter-bar { 
      background: #fff; 
      border-radius: 8px; 
      padding: 15px 20px; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    .operation-filter-item { 
      display: flex; 
      align-items: center; 
      gap: 10px; 
    }
    .operation-filter-item label { 
      font-weight: 500; 
      color: #333; 
      margin: 0;
      white-space: nowrap;
    }
    .operation-filter-item select { 
      min-width: 200px; 
    }
    
    .region-list { width: 250px; border-right: 1px solid #f0f0f0; padding-right: 20px; overflow-y: auto; max-height: 550px; }
    .region-item { padding: 10px 0; border-bottom: 1px solid #f5f5f5; cursor: pointer; }
    .region-item:hover { background-color: #f9f9f9; }
    .region-name { font-weight: 500; }
    .region-tag { font-size: 12px; color: #fff; background-color: #FF4D4F; padding: 2px 5px; border-radius: 3px; margin-left: 5px; }
    
    .region-cards { 
      flex: 1; 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
      gap: 20px; 
      overflow-y: auto;
      max-height: calc(100vh - 400px);
    }
    .region-card { 
      border: 1px solid #f0f0f0; 
      border-radius: 8px; 
      padding: 20px; 
      background: #fff;
      transition: box-shadow 0.2s, transform 0.2s; 
    }
    .region-card:hover { 
      box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
      transform: translateY(-2px);
    }
    .card-title { 
      font-weight: 600; 
      font-size: 16px;
      margin-bottom: 15px; 
      padding-bottom: 12px; 
      border-bottom: 2px solid #f0f0f0; 
      color: #333;
    }
    .card-data { 
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      margin-bottom: 12px; 
      font-size: 14px; 
      padding: 8px 0;
    }
    .data-label { 
      color: #666; 
      flex: 1;
    }
    .data-value { 
      font-weight: 600; 
      color: #333;
      font-size: 15px;
    }
    .data-sub { 
      font-size: 12px; 
      color: #999; 
      margin-top: 8px; 
      padding-top: 8px;
      border-top: 1px solid #f5f5f5;
      line-height: 1.6;
    }
    .operation-summary { 
      margin-top: 20px; 
      padding: 20px; 
      background: #f8f9fa;
      border-radius: 8px;
      border-top: 2px solid #e9ecef;
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }
    .operation-summary .summary-item {
      font-size: 14px;
      color: #666;
    }
    .operation-summary .summary-value {
      font-size: 16px;
      margin-left: 5px;
    }

    /* 筛选模态框样式 */
    .filter-modal .modal-body { padding: 20px; }
    .filter-group { margin-bottom: 15px; }
    .filter-group label { display: block; margin-bottom: 5px; font-weight: 500; }
    .filter-options { display: flex; flex-wrap: wrap; gap: 10px; }
    .filter-option { display: flex; align-items: center; gap: 5px; }
    
    /* 详情和档案模态框样式 */
    .detail-modal .modal-body { padding: 20px; }
    /* 确保模态框在全屏时也能显示 - 全屏z-index是9999，模态框需要更高 */
    .modal { z-index: 10001 !important; }
    .modal-backdrop { z-index: 10000 !important; }
    /* 全屏状态下，模态框需要确保在最上层 */
    .obj-kanban-fullscreen .modal,
    .caregiver-kanban-fullscreen .modal { z-index: 10001 !important; }
    .obj-kanban-fullscreen .modal-backdrop,
    .caregiver-kanban-fullscreen .modal-backdrop { z-index: 10000 !important; }
    /* 全屏状态下，操作栏也需要确保在最上层 */
    .obj-kanban-fullscreen .obj-action-bar,
    .caregiver-kanban-fullscreen .caregiver-action-bar { z-index: 10002 !important; }
    .form-group { margin-bottom: 15px; }
    .form-label { font-weight: 500; margin-bottom: 8px; display: block; font-size: 13px; }
    .form-control-plaintext { font-size: 14px; color: #333; }
    .archive-files { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 15px; }
    .archive-file-item { border: 1px solid #ddd; border-radius: 8px; padding: 10px; text-align: center; cursor: pointer; transition: all 0.3s; }
    .archive-file-item:hover { border-color: #1890FF; box-shadow: 0 2px 8px rgba(24, 144, 255, 0.2); }
    .archive-file-item img { width: 100%; height: 120px; object-fit: cover; border-radius: 4px; margin-bottom: 8px; }
    .archive-file-item .file-name { font-size: 12px; color: #666; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .btn-xs { padding: 2px 6px; font-size: 11px; }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- 侧边导航 -->
    <div class="sidebar">
      <div class="sidebar-logo">
        <img src="https://via.placeholder.com/80x40?text=居家长护" alt="系统Logo">
        <h3>服务主管工作平台</h3>
      </div>
      
      <!-- 导航分组：看板管理（新增） -->
      <div class="nav-group-title">看板管理</div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="数据驾驶舱.html" class="nav-link">
            <i class="fa fa-dashboard"></i>
            <span>数据驾驶舱</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="index.html" class="nav-link active">
            <i class="fa fa-dashboard"></i>
            <span>服务对象看板</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="总体统计.html" class="nav-link">
            <i class="fa fa-bar-chart"></i>
            <span>总体统计看板</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="流程管理.html" class="nav-link">
            <i class="fa fa-sitemap"></i>
            <span>流程管理</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="线上回访.html" class="nav-link">
            <i class="fa fa-phone"></i>
            <span>线上线下回访执行</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="服务对象分配.html" class="nav-link">
            <i class="fa fa-users"></i>
            <span>服务对象分配</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="新增服务对象管理.html" class="nav-link">
            <i class="fa fa-user-plus"></i>
            <span>新增服务对象配置</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="首月服务计划管理.html" class="nav-link">
            <i class="fa fa-calendar"></i>
            <span>服务计划管理或打印</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="平台工单差异查询.html" class="nav-link">
            <i class="fa fa-search"></i>
            <span>医保工单差异查询</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="工单管理.html" class="nav-link">
            <i class="fa fa-tasks"></i>
            <span>工单管理</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="重点服务对象管理.html" class="nav-link">
            <i class="fa fa-star"></i>
            <span>重点服务对象管理</span>
          </a>
        </li>
      </ul>
      
      <!-- 导航分组：系统设置 -->
      <div class="nav-group-title">系统设置</div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" class="nav-link" id="caregiverSettingsLink">
            <i class="fa fa-cog"></i>
            <span>护理员设置</span>
          </a>
        </li>=
      </ul>
    </div>

    <!-- 主内容区 -->
    <div class="main-content">
      <!-- 顶部导航：标题 + 用户信息 -->
      <div class="top-nav">
        <h1 class="page-title">看板管理</h1>
        <div class="user-info">
          <div class="notification">
            <i class="fa fa-bell-o"></i>
            <span class="notification-badge">2</span>
          </div>
          <div class="user-avatar">主</div>
          <div class="user-name">服务主管</div>
        </div>
      </div>

      <!-- 看板通用顶部筛选栏 -->
      <div class="kanban-header">
        <div class="month-selector">
          <label>统计月份：</label>
          <input type="month" id="statMonth" class="form-control" value="2025-10">
        </div>
        <div class="header-actions">
          <button id="refreshBtn" class="btn btn-outline-secondary refresh-btn">
            <i class="fa fa-refresh"></i> 刷新
          </button>
        </div>
      </div>

      <!-- 看板标签页 -->
      <ul class="nav nav-tabs kanban-tabs" id="kanbanTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="object-tab" data-bs-toggle="tab" data-bs-target="#object-kanban" type="button" role="tab" aria-controls="object-kanban" aria-selected="true">服务对象看板</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="caregiver-tab" data-bs-toggle="tab" data-bs-target="#caregiver-kanban" type="button" role="tab" aria-controls="caregiver-kanban" aria-selected="false">护理员看板</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="operation-tab" data-bs-toggle="tab" data-bs-target="#operation-kanban" type="button" role="tab" aria-controls="operation-kanban" aria-selected="false">派单信息</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="sync-tab" data-bs-toggle="tab" data-bs-target="#sync-kanban" type="button" role="tab" aria-controls="sync-kanban" aria-selected="false">工单同步管理</button>
        </li>
      </ul>

      <!-- 看板内容区 -->
      <div class="tab-content" id="kanbanTabContent">
        <!-- 服务对象看板 -->
        <div class="tab-pane fade show active" id="object-kanban" role="tabpanel" aria-labelledby="object-tab">
          <div class="kanban-content">
            <div class="obj-kanban-layout">
              <!-- 控制栏：筛选、排序、全屏 -->
              <div class="obj-controls">
                <div class="obj-controls-left">
                  <label class="me-2">区域筛选：</label>
                  <select class="form-select form-select-sm" id="objRegionFilter" style="width: 150px;">
                    <option value="">全部区域</option>
                    <option value="yuecheng">越城区</option>
                    <option value="keqiao">柯桥区</option>
                    <option value="shangyu">上虞区</option>
                    <option value="zhuji">诸暨市</option>
                    <option value="shengzhou">嵊州市</option>
                    <option value="xinchang">新昌县</option>
                  </select>
                  <label class="me-2 ms-3">排序列：</label>
                  <select class="form-select form-select-sm sort-select" id="objSortColumn">
                    <option value="address">地址</option>
                    <option value="remainHour">剩余服务时长</option>
                  </select>
                  <select class="form-select form-select-sm ms-2" id="objSortOrder" style="width: 100px;">
                    <option value="asc">升序</option>
                    <option value="desc">降序</option>
                  </select>
                </div>
                <div class="obj-controls-right">
                  <button class="btn btn-sm btn-outline-secondary" id="objFullscreenBtn">
                    <i class="fa fa-expand"></i> 全屏显示
                  </button>
                </div>
              </div>

              <!-- 服务对象数据表格 -->
              <div class="obj-table-container" id="objTableContainer">
                <table class="obj-table" id="objTable">
                  <thead>
                    <tr>
                      <th style="min-width: 100px;">姓名</th>
                      <th style="min-width: 50px;">性别</th>
                      <th style="min-width: 45px;">类别</th>
                      <th style="min-width: 120px;">地址</th>
                      <th style="min-width: 40px;">1</th>
                      <th style="min-width: 40px;">2</th>
                      <th style="min-width: 40px;">3</th>
                      <th style="min-width: 40px;">4</th>
                      <th style="min-width: 40px;">5</th>
                      <th style="min-width: 40px;">6</th>
                      <th style="min-width: 40px;">7</th>
                      <th style="min-width: 40px;">8</th>
                      <th style="min-width: 40px;">9</th>
                      <th style="min-width: 40px;">10</th>
                      <th style="min-width: 40px;">11</th>
                      <th style="min-width: 40px;">12</th>
                      <th style="min-width: 40px;">13</th>
                      <th style="min-width: 40px;">14</th>
                      <th style="min-width: 40px;">15</th>
                      <th style="min-width: 40px;">16</th>
                      <th style="min-width: 40px;">17</th>
                      <th style="min-width: 40px;">18</th>
                      <th style="min-width: 40px;">19</th>
                      <th style="min-width: 40px;">20</th>
                      <th style="min-width: 40px;">21</th>
                      <th style="min-width: 40px;">22</th>
                      <th style="min-width: 40px;">23</th>
                      <th style="min-width: 40px;">24</th>
                      <th style="min-width: 40px;">25</th>
                      <th style="min-width: 40px;">26</th>
                      <th style="min-width: 40px;">27</th>
                      <th style="min-width: 40px;">28</th>
                      <th style="min-width: 40px;">29</th>
                      <th style="min-width: 40px;">30</th>
                      <th style="min-width: 100px;">剩余服务时长</th>
                    </tr>
                  </thead>
                  <tbody id="objTableBody">
                    <!-- 数据将通过JavaScript动态生成 -->
                  </tbody>
                </table>
              </div>
              
              <!-- 操作栏（固定在底部） -->
              <div class="obj-action-bar" id="objActionBar">
                <div class="selected-info">
                  <span id="objSelectedInfo">已选择：<strong id="objSelectedName">-</strong></span>
                </div>
                <div class="action-buttons">
                  <button class="btn btn-sm btn-primary" id="objDetailBtn">
                    <i class="fa fa-info-circle"></i> 查看详情
                  </button>
                  <button class="btn btn-sm btn-outline-primary" id="objArchiveBtn">
                    <i class="fa fa-folder-open"></i> 查看档案
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 护理员看板 -->
        <div class="tab-pane fade" id="caregiver-kanban" role="tabpanel" aria-labelledby="caregiver-tab">
          <div class="kanban-content">
            <div class="caregiver-kanban-layout">
              <!-- 控制栏：图例和全屏 -->
              <div class="obj-controls">
                <div class="obj-controls-left">
                  <div class="caregiver-legend">
                    <span class="legend-label">图例：</span>
                    <span class="legend-item">
                      <span class="legend-color bill-num"></span>
                      <span class="legend-text">工单数</span>
                    </span>
                    <span class="legend-item">
                      <span class="legend-color plan-hour"></span>
                      <span class="legend-text">计划时长(h)</span>
                    </span>
                    <span class="legend-item">
                      <span class="legend-color work-hour"></span>
                      <span class="legend-text">实际时长(h)</span>
                    </span>
                  </div>
                </div>
                <div class="obj-controls-right">
                  <button class="btn btn-sm btn-outline-secondary" id="caregiverFullscreenBtn">
                    <i class="fa fa-expand"></i> 全屏显示
                  </button>
                </div>
              </div>
              <!-- 护理员数据表格 -->
              <div class="caregiver-table-container" id="caregiverTableContainer">
                <table class="caregiver-table" id="caregiverTable">
                    <thead>
                      <tr>
                      <th>护理员</th>
                      <th>1日</th>
                      <th>2日</th>
                      <th>3日</th>
                      <th>4日</th>
                      <th>5日</th>
                      <th>6日</th>
                      <th>7日</th>
                      <th>8日</th>
                      <th>9日</th>
                      <th>10日</th>
                      <th>11日</th>
                      <th>12日</th>
                      <th>13日</th>
                      <th>14日</th>
                      <th>15日</th>
                      <th>16日</th>
                      <th>17日</th>
                      <th>18日</th>
                      <th>19日</th>
                      <th>20日</th>
                      <th>21日</th>
                      <th>22日</th>
                      <th>23日</th>
                      <th>24日</th>
                      <th>25日</th>
                      <th>26日</th>
                      <th>27日</th>
                      <th>28日</th>
                      <th>29日</th>
                      <th>30日</th>
                      <th>31日</th>
                      </tr>
                    </thead>
                  <tbody id="caregiverTableBody">
                    <!-- 数据将通过JavaScript动态生成 -->
                    </tbody>
                  </table>
              </div>
              
              <!-- 护理员操作栏（固定在底部） -->
              <div class="caregiver-action-bar" id="caregiverActionBar">
                <div class="selected-info">
                  <span id="caregiverSelectedInfo">已选择：<strong id="caregiverSelectedName">-</strong></span>
                </div>
                <div class="action-buttons">
                  <button class="btn btn-sm btn-primary" id="caregiverDetailBtn">
                    <i class="fa fa-info-circle"></i> 查看详情
                  </button>
                  <button class="btn btn-sm btn-outline-primary" id="caregiverArchiveBtn">
                    <i class="fa fa-folder-open"></i> 查看档案
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 派单信息 -->
        <div class="tab-pane fade" id="operation-kanban" role="tabpanel" aria-labelledby="operation-tab">
          <div class="kanban-content">
            <div class="operation-kanban-layout">
              <!-- 派单信息子标签页 -->
              <ul class="nav nav-tabs" id="dispatchTabs" role="tablist" style="margin-bottom: 20px;">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="daily-dispatch-tab" data-bs-toggle="tab" data-bs-target="#daily-dispatch" type="button" role="tab">日派单</button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="monthly-dispatch-tab" data-bs-toggle="tab" data-bs-target="#monthly-dispatch" type="button" role="tab">月派单</button>
                </li>
              </ul>

              <div class="tab-content" id="dispatchTabContent">
                <!-- 日派单 -->
                <div class="tab-pane fade show active" id="daily-dispatch" role="tabpanel">
                  <div class="dispatch-controls" style="margin-bottom: 15px;">
                    <div class="operation-filter-bar">
                      <div class="operation-filter-item">
                        <label>日期：</label>
                        <input type="date" class="form-control form-control-sm" id="dailyDispatchDate" style="width: 150px;">
                      </div>
                      <div class="operation-filter-item">
                        <label>护理员分组：</label>
                        <select class="form-select form-select-sm" id="caregiverGroup" style="width: 200px;">
                          <option value="">全部护理员</option>
                          <option value="group1">第一组</option>
                          <option value="group2">第二组</option>
                          <option value="group3">第三组</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="daily-dispatch-container" id="dailyDispatchContainer" style="max-height: 600px; overflow-y: auto;">
                    <!-- 日派单内容将通过JavaScript动态生成 -->
                  </div>
                </div>

                <!-- 月派单 -->
                <div class="tab-pane fade" id="monthly-dispatch" role="tabpanel">
                  <div class="dispatch-controls" style="margin-bottom: 15px;">
                    <div class="operation-filter-bar">
                      <div class="operation-filter-item">
                        <label>月份：</label>
                        <input type="month" class="form-control form-control-sm" id="monthlyDispatchMonth" style="width: 150px;">
                      </div>
                    </div>
                  </div>
                  <div class="monthly-dispatch-container" id="monthlyDispatchContainer" style="max-height: 600px; overflow-y: auto;">
                    <!-- 月派单内容将通过JavaScript动态生成 -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 工单同步管理 -->
        <div class="tab-pane fade" id="sync-kanban" role="tabpanel" aria-labelledby="sync-tab">
          <div class="kanban-content">
            <div class="sync-kanban-layout">
              <!-- 筛选区 -->
              <div class="filter-bar" style="margin-bottom: 20px;">
                <div class="filter-group">
                  <label>同步状态</label>
                  <select class="form-select form-select-sm" id="syncStatusFilter">
                    <option value="all">全部状态</option>
                    <option value="unsynced">未同步</option>
                    <option value="synced">已同步</option>
                    <option value="resync">需重新同步</option>
                    <option value="deleted">已删除（需医保废弃）</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label>护理员</label>
                  <select class="form-select form-select-sm" id="syncCaregiverFilter">
                    <option value="all">所有护理员</option>
                    <option value="李护理">李护理</option>
                    <option value="王护理">王护理</option>
                    <option value="张护理">张护理</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label>服务日期</label>
                  <input type="date" class="form-control form-control-sm" id="syncDateFilter">
                </div>
                <div class="filter-group" style="align-self: flex-end;">
                  <button class="btn btn-sm btn-primary" id="syncQueryBtn">
                    <i class="fa fa-search"></i> 查询
                  </button>
                  <button class="btn btn-sm btn-outline-secondary" id="syncResetBtn">
                    <i class="fa fa-refresh"></i> 重置
                  </button>
                </div>
              </div>

              <!-- 同步工单表格 -->
              <div class="card">
                <div class="card-body p-0">
                  <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
                    <table class="table table-hover mb-0" id="syncTable">
                      <thead class="table-light sticky-top">
                        <tr>
                          <th style="width: 50px;"><input type="checkbox" id="syncSelectAll"></th>
                          <th style="width: 120px;">工单ID</th>
                          <th style="width: 100px;">服务对象</th>
                          <th style="width: 150px;">地址</th>
                          <th style="width: 100px;">护理员</th>
                          <th style="width: 120px;">服务日期</th>
                          <th style="width: 120px;">同步状态</th>
                          <th style="width: 100px;">同步人</th>
                          <th style="width: 150px;">同步时间</th>
                          <th style="width: 120px;">操作</th>
                        </tr>
                      </thead>
                      <tbody id="syncTableBody">
                        <!-- 数据将通过JavaScript动态生成 -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <!-- 批量操作 -->
              <div class="d-flex justify-content-between align-items-center mt-3">
                <div>
                  <button class="btn btn-sm btn-primary" id="batchSyncBtn" disabled>
                    <i class="fa fa-check"></i> 批量标记同步
                  </button>
                </div>
                <div>
                  <span class="text-muted" style="font-size: 13px;">共 <span id="syncTotalCount">0</span> 条记录</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 筛选模态框 -->
  <div class="modal fade filter-modal" id="filterModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">筛选条件</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="filterModalBody">
          <!-- 筛选内容根据当前看板动态切换 -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
          <button type="button" class="btn btn-primary" id="confirmFilterBtn">确认筛选</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 护理员设置模态框 -->
  <div class="modal fade" id="caregiverSettingsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">护理员设置</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">护理员分组管理</label>
            <div class="d-flex gap-2 mb-3">
              <input type="text" class="form-control" id="newGroupName" placeholder="输入新分组名称">
              <button class="btn btn-primary" id="addGroupBtn">添加分组</button>
            </div>
            <div id="groupList" class="mb-3">
              <!-- 分组列表将通过JavaScript动态生成 -->
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label">护理员列表</label>
            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
              <table class="table table-sm table-bordered">
                <thead class="table-light sticky-top">
                  <tr>
                    <th>姓名</th>
                    <th>简称</th>
                    <th>所属分组</th>
                    <th>组内次序</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="caregiverSettingsList">
                  <!-- 护理员列表将通过JavaScript动态生成 -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
          <button type="button" class="btn btn-primary" id="saveCaregiverSettingsBtn">保存设置</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 编辑护理员设置模态框 -->
  <div class="modal fade" id="editCaregiverModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">编辑护理员设置</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="editCaregiverId">
          <div class="mb-3">
            <label class="form-label">姓名</label>
            <input type="text" class="form-control" id="editCaregiverName" readonly>
          </div>
          <div class="mb-3">
            <label class="form-label">简称</label>
            <input type="text" class="form-control" id="editCaregiverShortName" placeholder="输入简称">
          </div>
          <div class="mb-3">
            <label class="form-label">所属分组</label>
            <select class="form-select" id="editCaregiverGroup">
              <option value="">未分组</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">组内显示次序</label>
            <input type="number" class="form-control" id="editCaregiverOrder" min="1" placeholder="数字越小越靠前">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
          <button type="button" class="btn btn-primary" id="saveEditCaregiverBtn">保存</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 服务对象详情和档案模态框 -->
  <div class="modal fade" id="objectDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="objectDetailModalTitle">服务对象详情</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul class="nav nav-tabs" id="objectDetailTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="object-basic-info-tab" data-bs-toggle="tab" data-bs-target="#object-basic-info" type="button" role="tab">基本信息</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="object-archive-info-tab" data-bs-toggle="tab" data-bs-target="#object-archive-info" type="button" role="tab">档案信息</button>
            </li>
          </ul>
          <div class="tab-content" id="objectDetailTabContent">
            <div class="tab-pane fade show active" id="object-basic-info" role="tabpanel">
              <div id="objectDetailBody" class="mt-3">
                <!-- 基本信息内容将通过JavaScript动态生成 -->
              </div>
            </div>
            <div class="tab-pane fade" id="object-archive-info" role="tabpanel">
              <div id="objectArchiveBody" class="mt-3">
                <!-- 档案信息内容将通过JavaScript动态生成 -->
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 护理员详情和档案模态框 -->
  <div class="modal fade" id="caregiverDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="caregiverDetailModalTitle">护理员详情</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul class="nav nav-tabs" id="caregiverDetailTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="caregiver-basic-info-tab" data-bs-toggle="tab" data-bs-target="#caregiver-basic-info" type="button" role="tab">基本信息</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="caregiver-archive-info-tab" data-bs-toggle="tab" data-bs-target="#caregiver-archive-info" type="button" role="tab">档案信息</button>
            </li>
          </ul>
          <div class="tab-content" id="caregiverDetailTabContent">
            <div class="tab-pane fade show active" id="caregiver-basic-info" role="tabpanel">
              <div id="caregiverDetailBody" class="mt-3">
                <!-- 基本信息内容将通过JavaScript动态生成 -->
              </div>
            </div>
            <div class="tab-pane fade" id="caregiver-archive-info" role="tabpanel">
              <div id="caregiverArchiveBody" class="mt-3">
                <!-- 档案信息内容将通过JavaScript动态生成 -->
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 流程发起模态框 -->
  <div class="modal fade" id="processModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="processModalTitle">发起流程申请</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="processForm">
            <input type="hidden" id="processObjectId">
            <input type="hidden" id="processObjectName">
            <input type="hidden" id="processType">
            
            <div class="mb-3">
              <label class="form-label">服务对象</label>
              <input type="text" class="form-control" id="processObjectNameDisplay" readonly>
            </div>
            
            <!-- 暂停申请表单 -->
            <div class="process-form-section" id="pauseFormSection">
              <div class="mb-3">
                <label class="form-label">暂停开始日期 <span class="text-danger">*</span></label>
                <input type="date" class="form-control" id="pauseStartDate" required>
              </div>
              <div class="mb-3">
                <label class="form-label">暂停类型 <span class="text-danger">*</span></label>
                <select class="form-select" id="pauseType" required>
                  <option value="">请选择</option>
                  <option value="temporary">暂时中止</option>
                  <option value="permanent">永久放弃</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">暂停原因 <span class="text-danger">*</span></label>
                <textarea class="form-control" id="pauseReason" rows="3" required placeholder="请详细说明暂停原因"></textarea>
              </div>
            </div>
            
            <!-- 恢复申请表单 -->
            <div class="process-form-section" id="resumeFormSection" style="display: none;">
              <div class="mb-3">
                <label class="form-label">恢复日期 <span class="text-danger">*</span></label>
                <input type="date" class="form-control" id="resumeDate" required>
              </div>
              <div class="mb-3">
                <label class="form-label">恢复原因 <span class="text-danger">*</span></label>
                <textarea class="form-control" id="resumeReason" rows="3" required placeholder="请详细说明恢复原因"></textarea>
              </div>
            </div>
            
            <!-- 转出申请表单 -->
            <div class="process-form-section" id="transferFormSection" style="display: none;">
              <div class="mb-3">
                <label class="form-label">转出日期 <span class="text-danger">*</span></label>
                <input type="date" class="form-control" id="transferDate" required>
              </div>
              <div class="mb-3">
                <label class="form-label">目标机构 <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="targetOrg" required placeholder="请输入目标机构名称">
              </div>
              <div class="mb-3">
                <label class="form-label">转出原因 <span class="text-danger">*</span></label>
                <textarea class="form-control" id="transferReason" rows="3" required placeholder="请详细说明转出原因"></textarea>
              </div>
            </div>
            
            <!-- 死亡申请表单 -->
            <div class="process-form-section" id="deathFormSection" style="display: none;">
              <div class="mb-3">
                <label class="form-label">死亡日期 <span class="text-danger">*</span></label>
                <input type="date" class="form-control" id="deathDate" required>
              </div>
              <div class="mb-3">
                <label class="form-label">死亡原因 <span class="text-danger">*</span></label>
                <textarea class="form-control" id="deathReason" rows="3" required placeholder="请详细说明死亡原因"></textarea>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
          <button type="button" class="btn btn-primary" id="submitProcessBtn">提交申请</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 提示模态框 -->
  <div class="modal fade" id="promptModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm">
      <div class="modal-body text-center py-4">
        <i class="fa fa-info-circle text-primary" style="font-size: 36px; margin-bottom: 15px;"></i>
        <h5 class="modal-title" id="promptTitle">操作提示</h5>
        <p class="text-muted" id="promptMsg">操作成功！</p>
        <button type="button" class="btn btn-primary mt-3" data-bs-dismiss="modal">确定</button>
      </div>
    </div>
  </div>

  <script>
    $(function() {
      // 初始化模态框
      const filterModal = new bootstrap.Modal('#filterModal');
      const promptModal = new bootstrap.Modal('#promptModal');

      // ========== 服务对象看板相关功能 ==========
      // 获取配置数据：每周最少服务次数（sys_config_value表，id=8）
      // 实际项目中应从后端API获取
      const minWeeklyServiceCount = 2; // 默认值，实际应从配置表获取
      
      // 模拟数据
      let objData = [
        { id: 1, name: '张三', nameColor: 'green', gender: '男', category: 'II', address: '越城区九十村58号', region: 'yuecheng', status: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30], remainHour: 45.5 },
        { id: 2, name: '李四', nameColor: 'orange', gender: '女', category: 'I', address: '柯桥区四五村18号', region: 'keqiao', status: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30], remainHour: 32.0 },
        { id: 3, name: '王五', nameColor: 'green', gender: '男', category: 'III', address: '上虞区三六村25号', region: 'shangyu', status: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30], remainHour: 18.5 },
        { id: 4, name: '赵六', nameColor: 'orange', gender: '女', category: 'II', address: '诸暨市一二村88号', region: 'zhuji', status: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30], remainHour: 60.0 }
      ];
      
      // 生成状态列数据（1-30列）
      function generateStatusData() {
        objData.forEach(obj => {
          const statusValues = [];
          for (let i = 1; i <= 30; i++) {
            if (i === 1) statusValues.push('S');
            else if (i === 2) statusValues.push('S');
            else if (i === 3) statusValues.push('S');
            else if (i === 30) statusValues.push('珍');
            else if (i <= 5) statusValues.push('L');
            else if (i <= 10) statusValues.push('Q');
            else statusValues.push('');
          }
          obj.statusValues = statusValues;
        });
      }
      generateStatusData();
      
      // 计算本周服务次数
      function calculateWeeklyServiceCount(obj) {
        // 获取当前日期和本周的日期范围
        const today = new Date();
        const dayOfWeek = today.getDay(); // 0=周日, 1=周一, ..., 6=周六
        const startOfWeek = new Date(today);
        startOfWeek.setDate(today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1)); // 本周一
        const endOfWeek = new Date(startOfWeek);
        endOfWeek.setDate(startOfWeek.getDate() + 6); // 本周日
        
        // 获取当前月份的第几天
        const currentDay = today.getDate();
        
        // 统计本周（1-7日，如果当前是月初）或本周实际日期范围内的服务次数
        // 这里简化处理：统计本月1-7日的服务次数作为本周服务次数
        // 实际项目中应该根据实际日期范围统计
        let serviceCount = 0;
        const weekDays = [1, 2, 3, 4, 5, 6, 7]; // 本周的日期（简化：假设是每月1-7日）
        
        weekDays.forEach(day => {
          if (day <= 30 && obj.statusValues && obj.statusValues[day - 1]) {
            const status = obj.statusValues[day - 1];
            // 如果状态不为空，表示有服务
            if (status && status.trim() !== '') {
              serviceCount++;
            }
          }
        });
        
        return serviceCount;
      }
      
      // 更新所有服务对象的本周服务次数
      function updateWeeklyServiceCounts() {
        objData.forEach(obj => {
          if (obj.weeklyServiceCount === undefined) {
            obj.weeklyServiceCount = calculateWeeklyServiceCount(obj);
          }
        });
      }
      updateWeeklyServiceCounts();
      
      // 计算本周服务次数
      function calculateWeeklyServiceCount(obj) {
        // 获取当前日期和本周的日期范围
        const today = new Date();
        const dayOfWeek = today.getDay(); // 0=周日, 1=周一, ..., 6=周六
        const startOfWeek = new Date(today);
        startOfWeek.setDate(today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1)); // 本周一
        const endOfWeek = new Date(startOfWeek);
        endOfWeek.setDate(startOfWeek.getDate() + 6); // 本周日
        
        // 获取当前月份的第几天
        const currentDay = today.getDate();
        
        // 统计本周（1-7日，如果当前是月初）或本周实际日期范围内的服务次数
        // 这里简化处理：统计本月1-7日的服务次数作为本周服务次数
        // 实际项目中应该根据实际日期范围统计
        let serviceCount = 0;
        const weekDays = [1, 2, 3, 4, 5, 6, 7]; // 本周的日期（简化：假设是每月1-7日）
        
        weekDays.forEach(day => {
          if (day <= 30 && obj.statusValues && obj.statusValues[day - 1]) {
            const status = obj.statusValues[day - 1];
            // 如果状态不为空，表示有服务
            if (status && status.trim() !== '') {
              serviceCount++;
            }
          }
        });
        
        return serviceCount;
      }
      
      // 更新所有服务对象的本周服务次数
      function updateWeeklyServiceCounts() {
        objData.forEach(obj => {
          if (obj.weeklyServiceCount === undefined) {
            obj.weeklyServiceCount = calculateWeeklyServiceCount(obj);
          }
        });
      }
      updateWeeklyServiceCounts();

      // 渲染服务对象表格
      function renderObjTable(data) {
        const tbody = $('#objTableBody');
        tbody.empty();
        
        data.forEach(obj => {
          const row = $('<tr>');
          
          // 计算本周服务次数
          const weeklyCount = obj.weeklyServiceCount !== undefined ? obj.weeklyServiceCount : calculateWeeklyServiceCount(obj);
          obj.weeklyServiceCount = weeklyCount;
          
          // 检查是否服务不足
          const isServiceInsufficient = weeklyCount < minWeeklyServiceCount;
          if (isServiceInsufficient) {
            row.addClass('service-insufficient');
          }
          
          // 姓名列：添加服务不足标识
          const nameClass = obj.nameColor === 'green' ? 'obj-name-green' : 'obj-name-orange';
          const insufficientBadge = isServiceInsufficient ? `<span class="service-insufficient-badge">服务不足</span>` : '';
          row.append(`<td class="${nameClass}">${obj.name}${insufficientBadge}</td>`);
          row.append(`<td>${obj.gender}</td>`);
          row.append(`<td>${obj.category}</td>`);
          
          // 地址列：部分显示，悬停显示全部
          const addressShort = obj.address.length > 10 ? obj.address.substring(0, 10) + '...' : obj.address;
          const addressCell = $(`<td class="obj-address-cell" title="${obj.address}">${addressShort}<span class="obj-address-full">${obj.address}</span></td>`);
          row.append(addressCell);
          
          // 生成1-30状态列
          for (let i = 0; i < 30; i++) {
            const day = i + 1;
            const status = obj.statusValues[i] || '';
            let cellClass = 'status-col-default';
            if (day === 1) cellClass = 'status-col-1';
            else if (day === 2) cellClass = 'status-col-2';
            else if (day === 3) cellClass = 'status-col-3';
            else if (day === 30) cellClass = 'status-col-30';
            
            row.append(`<td class="${cellClass}">${status}</td>`);
          }
          
          // 剩余服务时长列
          const remainHourClass = obj.remainHour < 20 ? 'summary-red' : '';
          row.append(`<td class="${remainHourClass}">${obj.remainHour}小时</td>`);
          
          // 添加行点击事件和选中状态
          row.attr('data-obj-id', obj.id);
          row.attr('data-obj-name', obj.name);
          
          tbody.append(row);
        });
      }

      // 筛选和排序功能
      function filterAndSortObjData() {
        const region = $('#objRegionFilter').val();
        const column = $('#objSortColumn').val();
        const order = $('#objSortOrder').val();
        
        // 区域筛选
        let filteredData = objData;
        if (region) {
          filteredData = objData.filter(obj => obj.region === region);
        }
        
        // 排序
        filteredData.sort((a, b) => {
          let aVal, bVal;
          if (column === 'address') {
            aVal = a.address;
            bVal = b.address;
          } else if (column === 'remainHour') {
            aVal = a.remainHour;
            bVal = b.remainHour;
          }
          
          if (order === 'asc') {
            return aVal > bVal ? 1 : (aVal < bVal ? -1 : 0);
          } else {
            return aVal < bVal ? 1 : (aVal > bVal ? -1 : 0);
          }
        });
        
        renderObjTable(filteredData);
      }

      // 全屏显示功能
      let isFullscreen = false;
      $('#objFullscreenBtn').click(function() {
        const kanbanContent = $('#object-kanban .kanban-content');
        if (!isFullscreen) {
          kanbanContent.addClass('obj-kanban-fullscreen');
          $(this).html('<i class="fa fa-compress"></i> 退出全屏');
          isFullscreen = true;
        } else {
          kanbanContent.removeClass('obj-kanban-fullscreen');
          $(this).html('<i class="fa fa-expand"></i> 全屏显示');
          isFullscreen = false;
        }
      });

      // 绑定事件
      $('#objRegionFilter, #objSortColumn, #objSortOrder').change(function() {
        filterAndSortObjData();
      });
      
      // 表格行点击事件（选中行）
      let selectedObjId = null;
      $(document).on('click', '#objTable tbody tr', function() {
        // 移除其他行的选中状态
        $('#objTable tbody tr').removeClass('selected');
        // 添加当前行的选中状态
        $(this).addClass('selected');
        
        // 获取选中行的数据
        selectedObjId = parseInt($(this).data('obj-id'));
        const selectedObjName = $(this).data('obj-name');
        
        // 显示操作栏
        $('#objSelectedName').text(selectedObjName);
        $('#objActionBar').addClass('show');
      });
      
      // 操作栏按钮事件
      $('#objDetailBtn').click(function() {
        if (!selectedObjId) return;
        const obj = objData.find(o => o.id === selectedObjId);
        if (!obj) return;
        
        // 触发查看详情
        showObjectDetail(obj.id);
      });
      
      $('#objArchiveBtn').click(function() {
        if (!selectedObjId) return;
        const obj = objData.find(o => o.id === selectedObjId);
        if (!obj) return;
        
        // 触发查看档案
        showObjectArchive(obj.id);
      });
      
      // 封装查看详情和档案的函数
      function showObjectDetail(objId) {
        const obj = objData.find(o => o.id === objId);
        if (!obj) return;
        
        // 生成基本信息HTML
        const basicInfoHtml = `
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">姓名</label>
                <div class="form-control-plaintext">${obj.name}</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">性别</label>
                <div class="form-control-plaintext">${obj.gender}</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">失能等级</label>
                <div class="form-control-plaintext">${obj.category}级</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">地址</label>
                <div class="form-control-plaintext">${obj.address}</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">剩余服务时长</label>
                <div class="form-control-plaintext">${obj.remainHour}小时</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">所属区域</label>
                <div class="form-control-plaintext">${getRegionName(obj.region)}</div>
              </div>
            </div>
          </div>
        `;
        
        const archiveHtml = generateObjectArchiveHtml(objId);
        
        $('#objectDetailModalTitle').text(`服务对象详情 - ${obj.name}`);
        $('#objectDetailBody').html(basicInfoHtml);
        $('#objectArchiveBody').html(archiveHtml);
        objectDetailModal.show();
      }
      
      function showObjectArchive(objId) {
        const obj = objData.find(o => o.id === objId);
        if (!obj) return;
        
        // 显示详情模态框并切换到档案标签页
        $('#objectDetailModalTitle').text(`服务对象详情 - ${obj.name}`);
        const basicInfoHtml = `
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">姓名</label>
                <div class="form-control-plaintext">${obj.name}</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">性别</label>
                <div class="form-control-plaintext">${obj.gender}</div>
              </div>
            </div>
          </div>
        `;
        $('#objectDetailBody').html(basicInfoHtml);
        $('#objectArchiveBody').html(generateObjectArchiveHtml(objId));
        objectDetailModal.show();
        setTimeout(() => {
          $('#object-archive-info-tab').click();
        }, 300);
      }

      // 初始化
      filterAndSortObjData();

      // ========== 护理员看板相关功能 ==========
      // 模拟护理员数据
      let caregiverData = [
        { id: 1, name: '李护理', shortName: '', group: '', order: 0, dailyData: {} },
        { id: 2, name: '王护理', shortName: '', group: '', order: 0, dailyData: {} },
        { id: 3, name: '张护理', shortName: '', group: '', order: 0, dailyData: {} }
      ];
      
      // 护理员分组数据
      let caregiverGroups = [];
      
      // 从localStorage加载护理员设置
      function loadCaregiverSettings() {
        const saved = localStorage.getItem('caregiverSettings');
        if (saved) {
          const settings = JSON.parse(saved);
          caregiverData.forEach(caregiver => {
            const setting = settings.find(s => s.id === caregiver.id);
            if (setting) {
              caregiver.shortName = setting.shortName || '';
              caregiver.group = setting.group || '';
              caregiver.order = setting.order || 0;
            }
          });
        }
        
        const savedGroups = localStorage.getItem('caregiverGroups');
        if (savedGroups) {
          caregiverGroups = JSON.parse(savedGroups);
        }
      }
      
      // 保存护理员设置到localStorage
      function saveCaregiverSettings() {
        const settings = caregiverData.map(c => ({
          id: c.id,
          shortName: c.shortName,
          group: c.group,
          order: c.order
        }));
        localStorage.setItem('caregiverSettings', JSON.stringify(settings));
        localStorage.setItem('caregiverGroups', JSON.stringify(caregiverGroups));
      }
      
      // 初始化护理员设置
      loadCaregiverSettings();

      // 生成每日数据（1-31日）和派单信息
      function generateDailyData() {
        caregiverData.forEach(caregiver => {
          for (let day = 1; day <= 31; day++) {
            const billNum = Math.floor(Math.random() * 5) + 1;
            const planHour = parseFloat((Math.random() * 8 + 2).toFixed(1));
            const workHour = parseFloat((Math.random() * 8 + 1).toFixed(1));
            
            // 生成派单信息（服务对象姓名、时间、套餐）
            const dispatchList = [];
            for (let i = 0; i < billNum; i++) {
              const names = ['张三', '李四', '王五', '赵六', '孙七', '周八', '吴九', '郑十'];
              const packages = ['基础套餐', '标准套餐', '高级套餐', '特护套餐'];
              const times = ['08:00', '09:00', '10:00', '14:00', '15:00', '16:00'];
              dispatchList.push({
                name: names[Math.floor(Math.random() * names.length)],
                time: times[Math.floor(Math.random() * times.length)],
                package: packages[Math.floor(Math.random() * packages.length)]
              });
            }
            
            caregiver.dailyData[day] = {
              plan_bill_num: billNum, // 工单总数
              plan_hour: planHour, // 计划时长
              work_hour: workHour, // 实际时长
              dispatch_list: dispatchList // 派单列表
            };
          }
        });
      }
      generateDailyData();

      // 模拟服务对象数据（每个护理员负责的服务对象）
      let caregiverObjData = {
        1: [
          { name: '张三', address: '越城区九十村58号', level: 'II级', status: '正常', work_hour: 2.0, remain_hour: 45.5 },
          { name: '李四', address: '柯桥区四五村18号', level: 'I级', status: '正常', work_hour: 2.0, remain_hour: 32.0 },
          { name: '王五', address: '上虞区三六村25号', level: 'III级', status: '暂停', work_hour: 1.5, remain_hour: 18.5 }
        ],
        2: [
          { name: '赵六', address: '诸暨市一二村88号', level: 'II级', status: '正常', work_hour: 2.0, remain_hour: 60.0 },
          { name: '孙七', address: '嵊州市七八村66号', level: 'I级', status: '正常', work_hour: 2.5, remain_hour: 28.5 }
        ],
        3: [
          { name: '周八', address: '新昌县九九村33号', level: 'II级', status: '正常', work_hour: 1.8, remain_hour: 42.2 },
          { name: '吴九', address: '越城区一一村22号', level: 'III级', status: '正常', work_hour: 2.5, remain_hour: 15.0 },
          { name: '郑十', address: '柯桥区二二村11号', level: 'I级', status: '停止', work_hour: 1.5, remain_hour: 0 }
        ]
      };

      // 渲染护理员表格
      function renderCaregiverTable() {
        const tbody = $('#caregiverTableBody');
        tbody.empty();
        
        caregiverData.forEach(caregiver => {
          // 护理员主行
          const mainRow = $('<tr class="caregiver-main-row" data-caregiver-id="' + caregiver.id + '">');
          const displayName = caregiver.shortName || caregiver.name;
          const nameCell = $(`
            <td>
              <div style="display: flex; align-items: center; gap: 5px;">
                <span class="caregiver-expand-btn" data-id="${caregiver.id}">▼</span>
                <span>${displayName}</span>
              </div>
            </td>
          `);
          mainRow.append(nameCell);
          // 添加行点击事件和选中状态
          mainRow.attr('data-caregiver-id', caregiver.id);
          mainRow.attr('data-caregiver-name', caregiver.name);
          
          // 生成每日数据单元格
          for (let day = 1; day <= 31; day++) {
            const data = caregiver.dailyData[day];
            const cell = $(`<td class="caregiver-day-cell" data-caregiver-id="${caregiver.id}" data-day="${day}">`);
            
            // 只显示数字，用颜色区分
            const dayContent = $('<div class="caregiver-day-content"></div>');
            dayContent.append(`<div class="caregiver-day-item bill-num">${data.plan_bill_num}</div>`);
            dayContent.append(`<div class="caregiver-day-item plan-hour">${data.plan_hour}</div>`);
            dayContent.append(`<div class="caregiver-day-item work-hour">${data.work_hour}</div>`);
            cell.append(dayContent);
            
            // 创建悬停提示框 - 显示派单情况（添加到body，避免被表格容器裁剪）
            const tooltipId = `tooltip-${caregiver.id}-${day}`;
            let tooltipHtml = `<div class="caregiver-tooltip" id="${tooltipId}">`;
            tooltipHtml += `<div class="caregiver-tooltip-title">${caregiver.name} - ${day}日派单情况</div>`;
            if (data.dispatch_list && data.dispatch_list.length > 0) {
              data.dispatch_list.forEach((dispatch, index) => {
                // 需要从objData中找到对应的服务对象ID
                const obj = objData.find(o => o.name === dispatch.name);
                const objId = obj ? obj.id : null;
                const detailLink = objId ? `<a href="javascript:void(0)" class="obj-detail-link" data-id="${objId}" title="查看详情"><i class="fa fa-info-circle"></i></a>` : '';
                const archiveLink = objId ? `<a href="javascript:void(0)" class="obj-archive-link" data-id="${objId}" title="查看档案"><i class="fa fa-folder-open"></i></a>` : '';
                
                tooltipHtml += `
                  <div class="caregiver-tooltip-item">
                    <div class="caregiver-tooltip-item-row">
                      <span class="caregiver-tooltip-item-name">
                        ${dispatch.name}
                        ${detailLink}
                        ${archiveLink}
                      </span>
                      <span class="caregiver-tooltip-item-detail">
                        <span>${dispatch.time}</span>
                        <span>${dispatch.package}</span>
                      </span>
                    </div>
                  </div>
                `;
              });
            } else {
              tooltipHtml += '<div class="caregiver-tooltip-item">暂无派单</div>';
            }
            tooltipHtml += '</div>';
            
            // 将提示框添加到body，而不是单元格
            if ($(`#${tooltipId}`).length === 0) {
              $('body').append(tooltipHtml);
            }
            mainRow.append(cell);
          }
          
          tbody.append(mainRow);
          
          // 服务对象详情行（默认隐藏）
          const detailRow = $('<tr class="caregiver-obj-detail-row" data-caregiver-id="' + caregiver.id + '">');
          const detailCell = $('<td colspan="32">');
          const objList = caregiverObjData[caregiver.id] || [];
          
          if (objList.length > 0) {
            const detailTable = $(`
              <table class="caregiver-obj-detail-table">
                <thead>
                  <tr>
                    <th>姓名</th>
                    <th>地址</th>
                    <th>级别</th>
                    <th>状态</th>
                    <th>已服务时长(小时)</th>
                    <th>剩余服务时长(小时)</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>
              </table>
            `);
            
            const detailTbody = detailTable.find('tbody');
            objList.forEach(obj => {
              let statusClass = 'status-normal';
              if (obj.status === '暂停') statusClass = 'status-pause';
              else if (obj.status === '停止') statusClass = 'status-stop';
              
              // 从objData中找到对应的服务对象ID
              const objDataItem = objData.find(o => o.name === obj.name);
              const objId = objDataItem ? objDataItem.id : null;
              const detailLink = objId ? `<a href="javascript:void(0)" class="obj-detail-link" data-id="${objId}" title="查看详情" style="color: #1890FF; margin-left: 8px;"><i class="fa fa-info-circle"></i></a>` : '';
              const archiveLink = objId ? `<a href="javascript:void(0)" class="obj-archive-link" data-id="${objId}" title="查看档案" style="color: #1890FF; margin-left: 5px;"><i class="fa fa-folder-open"></i></a>` : '';
              
              detailTbody.append(`
                <tr>
                  <td>
                    ${obj.name}
                    ${detailLink}
                    ${archiveLink}
                  </td>
                  <td>${obj.address}</td>
                  <td>${obj.level}</td>
                  <td class="${statusClass}">${obj.status}</td>
                  <td>${obj.work_hour}</td>
                  <td>${obj.remain_hour}</td>
                </tr>
              `);
            });
            
            detailCell.append(detailTable);
          } else {
            detailCell.text('暂无服务对象数据');
          }
          
          detailRow.append(detailCell);
          tbody.append(detailRow);
        });
      }

      // 绑定护理员展开/收起事件
      $(document).on('click', '.caregiver-expand-btn', function(e) {
        e.stopPropagation();
        const caregiverId = $(this).data('id');
        const detailRow = $(`.caregiver-obj-detail-row[data-caregiver-id="${caregiverId}"]`);
        const btn = $(this);
        
        if (detailRow.hasClass('show')) {
          detailRow.removeClass('show');
          btn.text('▼');
        } else {
          detailRow.addClass('show');
          btn.text('▲');
        }
      });

      // 绑定单元格悬停事件
      function updateTooltipPosition(cell, tooltip) {
        // 获取单元格的位置
        const cellOffset = $(cell).offset();
        const cellWidth = $(cell).outerWidth();
        const scrollTop = $(window).scrollTop();
        const scrollLeft = $(window).scrollLeft();
        
        // 计算提示框位置（在单元格上方居中）
        const tooltipWidth = 350;
        const tooltipHeight = tooltip.outerHeight() || 200;
        let left = cellOffset.left + (cellWidth / 2) - (tooltipWidth / 2) - scrollLeft;
        let top = cellOffset.top - tooltipHeight - 10 - scrollTop;
        
        // 确保提示框不超出视口右边界
        if (left + tooltipWidth > $(window).width()) {
          left = $(window).width() - tooltipWidth - 10;
        }
        // 确保提示框不超出视口左边界
        if (left < 10) {
          left = 10;
        }
        // 如果上方空间不足，显示在下方
        if (top < 10) {
          top = cellOffset.top + $(cell).outerHeight() + 10 - scrollTop;
        }
        
        // 设置提示框位置
        tooltip.css({
          left: left + 'px',
          top: top + 'px',
          transform: 'none'
        });
      }
      
      $(document).on('mouseenter', '.caregiver-day-cell', function(e) {
        const caregiverId = $(this).data('caregiver-id');
        const day = $(this).data('day');
        const tooltip = $(`#tooltip-${caregiverId}-${day}`);
        
        if (tooltip.length === 0) return;
        
        // 更新位置并显示
        updateTooltipPosition(this, tooltip);
        tooltip.addClass('show');
      });
      
      // 滚动时更新提示框位置
      $(window).on('scroll resize', function() {
        $('.caregiver-tooltip.show').each(function() {
          const tooltipId = $(this).attr('id');
          const parts = tooltipId.split('-');
          if (parts.length >= 3) {
            const caregiverId = parts[1];
            const day = parts[2];
            const cell = $(`.caregiver-day-cell[data-caregiver-id="${caregiverId}"][data-day="${day}"]`);
            if (cell.length > 0) {
              updateTooltipPosition(cell[0], $(this));
            }
          }
        });
      });

      $(document).on('mouseleave', '.caregiver-day-cell', function(e) {
        // 如果鼠标移动到提示框内，不隐藏提示框
        const caregiverId = $(this).data('caregiver-id');
        const day = $(this).data('day');
        const tooltip = $(`#tooltip-${caregiverId}-${day}`);
        const relatedTarget = e.relatedTarget;
        if (relatedTarget && tooltip.length > 0 && (tooltip[0].contains(relatedTarget) || $(relatedTarget).closest('.caregiver-tooltip').length > 0)) {
          return;
        }
        if (tooltip.length > 0) {
          tooltip.removeClass('show');
        }
      });
      
      // 提示框鼠标离开时隐藏
      $(document).on('mouseleave', '.caregiver-tooltip', function() {
        $(this).removeClass('show');
      });

      // 全屏显示功能
      let isCaregiverFullscreen = false;
      $('#caregiverFullscreenBtn').click(function() {
        const kanbanContent = $('#caregiver-kanban .kanban-content');
        if (!isCaregiverFullscreen) {
          kanbanContent.addClass('caregiver-kanban-fullscreen');
          $(this).html('<i class="fa fa-compress"></i> 退出全屏');
          isCaregiverFullscreen = true;
        } else {
          kanbanContent.removeClass('caregiver-kanban-fullscreen');
          $(this).html('<i class="fa fa-expand"></i> 全屏显示');
          isCaregiverFullscreen = false;
        }
      });

      // 初始化护理员表格
      renderCaregiverTable();
      
      // 护理员表格行点击事件（选中行）
      let selectedCaregiverId = null;
      $(document).on('click', '#caregiverTable tbody tr.caregiver-main-row', function(e) {
        // 如果点击的是展开按钮，不触发选中
        if ($(e.target).hasClass('caregiver-expand-btn')) {
          return;
        }
        
        // 移除其他行的选中状态
        $('#caregiverTable tbody tr.caregiver-main-row').removeClass('selected');
        // 添加当前行的选中状态
        $(this).addClass('selected');
        
        // 获取选中行的数据
        selectedCaregiverId = parseInt($(this).data('caregiver-id'));
        const selectedCaregiverName = $(this).data('caregiver-name');
        
        // 显示操作栏
        $('#caregiverSelectedName').text(selectedCaregiverName);
        $('#caregiverActionBar').addClass('show');
      });
      
      // 悬停提示框和服务对象详情表格中的服务对象详情和档案链接事件
      $(document).on('click', '.obj-detail-link', function(e) {
        e.stopPropagation();
        const objId = parseInt($(this).data('id'));
        showObjectDetail(objId);
      });
      
      $(document).on('click', '.obj-archive-link', function(e) {
        e.stopPropagation();
        const objId = parseInt($(this).data('id'));
        showObjectArchive(objId);
      });
      
      // 护理员操作栏按钮事件
      $('#caregiverDetailBtn').click(function() {
        if (!selectedCaregiverId) return;
        const caregiver = caregiverData.find(c => c.id === selectedCaregiverId);
        if (!caregiver) return;
        
        // 触发查看详情
        showCaregiverDetail(selectedCaregiverId);
      });
      
      $('#caregiverArchiveBtn').click(function() {
        if (!selectedCaregiverId) return;
        const caregiver = caregiverData.find(c => c.id === selectedCaregiverId);
        if (!caregiver) return;
        
        // 触发查看档案
        showCaregiverArchive(selectedCaregiverId);
      });
      
      // 封装查看护理员详情和档案的函数
      function showCaregiverDetail(caregiverId) {
        const caregiver = caregiverData.find(c => c.id === caregiverId);
        if (!caregiver) return;
        
        // 生成基本信息HTML
        const basicInfoHtml = `
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">姓名</label>
                <div class="form-control-plaintext">${caregiver.name}</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">简称</label>
                <div class="form-control-plaintext">${caregiver.shortName || '-'}</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">所属分组</label>
                <div class="form-control-plaintext">${caregiver.group || '未分组'}</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">组内显示次序</label>
                <div class="form-control-plaintext">${caregiver.order || '-'}</div>
              </div>
            </div>
          </div>
        `;
        
        const archiveHtml = generateCaregiverArchiveHtml(caregiverId);
        
        $('#caregiverDetailModalTitle').text(`护理员详情 - ${caregiver.name}`);
        $('#caregiverDetailBody').html(basicInfoHtml);
        $('#caregiverArchiveBody').html(archiveHtml);
        caregiverDetailModal.show();
      }
      
      function showCaregiverArchive(caregiverId) {
        const caregiver = caregiverData.find(c => c.id === caregiverId);
        if (!caregiver) return;
        
        // 显示详情模态框并切换到档案标签页
        $('#caregiverDetailModalTitle').text(`护理员详情 - ${caregiver.name}`);
        const basicInfoHtml = `
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">姓名</label>
                <div class="form-control-plaintext">${caregiver.name}</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">简称</label>
                <div class="form-control-plaintext">${caregiver.shortName || '-'}</div>
              </div>
            </div>
          </div>
        `;
        $('#caregiverDetailBody').html(basicInfoHtml);
        $('#caregiverArchiveBody').html(generateCaregiverArchiveHtml(caregiverId));
        caregiverDetailModal.show();
        setTimeout(() => {
          $('#caregiver-archive-info-tab').click();
        }, 300);
      }

      // ========== 派单信息相关功能 ==========

      // 渲染日派单
      function renderDailyDispatch() {
        const container = $('#dailyDispatchContainer');
        container.empty();
        
        const selectedDate = $('#dailyDispatchDate').val() || new Date().toISOString().split('T')[0];
        const selectedGroup = $('#caregiverGroup').val();
        
        // 获取选中的护理员
        let displayCaregivers = [...caregiverData];
        if (selectedGroup) {
          displayCaregivers = caregiverData.filter(c => c.group === selectedGroup);
        }
        
        // 按分组和次序排序
        displayCaregivers.sort((a, b) => {
          if (a.group !== b.group) {
            if (!a.group) return 1;
            if (!b.group) return -1;
            return a.group.localeCompare(b.group);
          }
          return (a.order || 999) - (b.order || 999);
        });
        
        // 按分组显示 - 表格形式（先行后列）
        if (selectedGroup) {
          // 显示指定分组 - 表格形式
          const groupTitle = $('#caregiverGroup option:selected').text();
          
          // 创建表格
          const table = $('<table class="daily-dispatch-table"></table>');
          const thead = $('<thead></thead>');
          const headerRow = $('<tr></tr>');
          headerRow.append('<th>分组</th>');
          displayCaregivers.forEach(caregiver => {
            const displayName = caregiver.shortName || caregiver.name;
            headerRow.append(`<th>${displayName}</th>`);
          });
          thead.append(headerRow);
          table.append(thead);
          
          const tbody = $('<tbody></tbody>');
          const row = $('<tr></tr>');
          row.append(`<td>${groupTitle}</td>`);
          
          displayCaregivers.forEach(caregiver => {
            const day = parseInt(selectedDate.split('-')[2]);
            const dispatchData = caregiver.dailyData[day] || { dispatch_list: [] };
            const cell = $('<td class="daily-dispatch-cell"></td>');
            
            if (dispatchData.dispatch_list && dispatchData.dispatch_list.length > 0) {
              dispatchData.dispatch_list.forEach(dispatch => {
                const itemDiv = $(`
                  <div class="daily-dispatch-item">
                    <div class="daily-dispatch-item-name">${dispatch.name}</div>
                    <div class="daily-dispatch-item-time">${dispatch.time}</div>
                    <div class="daily-dispatch-item-package">${dispatch.package}</div>
                  </div>
                `);
                cell.append(itemDiv);
              });
            } else {
              cell.html('<span style="color: #999; font-size: 12px;">暂无派单</span>');
            }
            
            row.append(cell);
          });
          
          tbody.append(row);
          table.append(tbody);
          container.append(table);
        } else {
          // 显示所有护理员，按分组显示 - 改为表格形式（先行后列）
          const groupedCaregivers = {};
          displayCaregivers.forEach(caregiver => {
            const group = caregiver.group || '未分组';
            if (!groupedCaregivers[group]) {
              groupedCaregivers[group] = [];
            }
            groupedCaregivers[group].push(caregiver);
          });
          
          // 按分组名称排序
          const sortedGroups = Object.keys(groupedCaregivers).sort((a, b) => {
            if (a === '未分组') return 1;
            if (b === '未分组') return -1;
            return a.localeCompare(b);
          });
          
          // 收集所有护理员（按分组和组内顺序）
          const allCaregivers = [];
          sortedGroups.forEach(groupName => {
            const groupCaregivers = groupedCaregivers[groupName].sort((a, b) => {
              return (a.order || 999) - (b.order || 999);
            });
            allCaregivers.push(...groupCaregivers);
          });
          
          if (allCaregivers.length > 0) {
            // 创建表格
            const table = $('<table class="daily-dispatch-table"></table>');
            const thead = $('<thead></thead>');
            const headerRow = $('<tr></tr>');
            headerRow.append('<th>分组</th>');
            allCaregivers.forEach(caregiver => {
              const displayName = caregiver.shortName || caregiver.name;
              headerRow.append(`<th>${displayName}</th>`);
            });
            thead.append(headerRow);
            table.append(thead);
            
            const tbody = $('<tbody></tbody>');
            
            // 按分组创建行
            sortedGroups.forEach(groupName => {
              const groupCaregivers = groupedCaregivers[groupName].sort((a, b) => {
                return (a.order || 999) - (b.order || 999);
              });
              
              if (groupCaregivers.length > 0) {
                const row = $('<tr></tr>');
                row.append(`<td>${groupName}</td>`);
                
                // 为每个护理员创建单元格
                allCaregivers.forEach(caregiver => {
                  const cell = $('<td class="daily-dispatch-cell"></td>');
                  
                  // 如果该护理员属于当前分组，显示其派单
                  if (groupCaregivers.some(c => c.id === caregiver.id)) {
                    const day = parseInt(selectedDate.split('-')[2]);
                    const dispatchData = caregiver.dailyData[day] || { dispatch_list: [] };
                    
                    if (dispatchData.dispatch_list && dispatchData.dispatch_list.length > 0) {
                      dispatchData.dispatch_list.forEach(dispatch => {
                        const itemDiv = $(`
                          <div class="daily-dispatch-item">
                            <div class="daily-dispatch-item-name">${dispatch.name}</div>
                            <div class="daily-dispatch-item-time">${dispatch.time}</div>
                            <div class="daily-dispatch-item-package">${dispatch.package}</div>
                          </div>
                        `);
                        cell.append(itemDiv);
                      });
                    } else {
                      cell.html('<span style="color: #999; font-size: 12px;">暂无派单</span>');
                    }
                  } else {
                    cell.html('');
                  }
                  
                  row.append(cell);
                });
                
                tbody.append(row);
              }
            });
            
            table.append(tbody);
            container.append(table);
          }
        }
      }

      // 渲染月派单 - 表格形式（先行后列）
      function renderMonthlyDispatch() {
        const container = $('#monthlyDispatchContainer');
        container.empty();
        
        const selectedMonth = $('#monthlyDispatchMonth').val() || new Date().toISOString().substring(0, 7);
        
        // 获取该月的天数
        const [year, month] = selectedMonth.split('-');
        const daysInMonth = new Date(year, month, 0).getDate();
        
        // 收集所有护理员，按分组和组内顺序
        const groupedCaregivers = {};
        caregiverData.forEach(caregiver => {
          const group = caregiver.group || '未分组';
          if (!groupedCaregivers[group]) {
            groupedCaregivers[group] = [];
          }
          groupedCaregivers[group].push(caregiver);
        });
        
        // 按分组名称排序
        const sortedGroups = Object.keys(groupedCaregivers).sort((a, b) => {
          if (a === '未分组') return 1;
          if (b === '未分组') return -1;
          return a.localeCompare(b);
        });
        
        // 收集所有护理员（按分组和组内顺序）
        const allCaregivers = [];
        sortedGroups.forEach(groupName => {
          const groupCaregivers = groupedCaregivers[groupName].sort((a, b) => {
            return (a.order || 999) - (b.order || 999);
          });
          allCaregivers.push(...groupCaregivers);
        });
        
        if (allCaregivers.length === 0) {
          container.html('<div style="text-align: center; padding: 40px; color: #999;">暂无护理员数据</div>');
          return;
        }
        
        // 创建表格
        const table = $('<table class="monthly-dispatch-table"></table>');
        const thead = $('<thead></thead>');
        const headerRow = $('<tr></tr>');
        headerRow.append('<th>日期</th>');
        allCaregivers.forEach(caregiver => {
          const displayName = caregiver.shortName || caregiver.name;
          headerRow.append(`<th>${displayName}</th>`);
        });
        thead.append(headerRow);
        table.append(thead);
        
        const tbody = $('<tbody></tbody>');
        
        // 为每一天创建一行
        for (let day = 1; day <= daysInMonth; day++) {
          const row = $('<tr></tr>');
          row.append(`<td>${day}日</td>`);
          
          // 为每个护理员创建单元格
          allCaregivers.forEach(caregiver => {
            const cell = $('<td class="monthly-dispatch-cell"></td>');
            const dispatchData = caregiver.dailyData[day] || { dispatch_list: [] };
            
            if (dispatchData.dispatch_list && dispatchData.dispatch_list.length > 0) {
              dispatchData.dispatch_list.forEach(dispatch => {
                const itemDiv = $(`
                  <div class="monthly-dispatch-item">
                    <div class="monthly-dispatch-item-name">${dispatch.name}</div>
                    <div class="monthly-dispatch-item-time">${dispatch.time}</div>
                    <div class="monthly-dispatch-item-package">${dispatch.package}</div>
                  </div>
                `);
                cell.append(itemDiv);
              });
            } else {
              cell.html('<span style="color: #999; font-size: 12px;">-</span>');
            }
            
            row.append(cell);
          });
          
          tbody.append(row);
        }
        
        table.append(tbody);
        container.append(table);
      }

      // 初始化护理员下拉框
      function initMonthlyCaregiverSelect() {
        const select = $('#monthlyCaregiver');
        select.empty();
        select.append('<option value="">请选择护理员</option>');
        // 按分组和次序排序
        const sortedCaregivers = [...caregiverData].sort((a, b) => {
          if (a.group !== b.group) {
            if (!a.group) return 1;
            if (!b.group) return -1;
            return a.group.localeCompare(b.group);
          }
          return (a.order || 999) - (b.order || 999);
        });
        sortedCaregivers.forEach(caregiver => {
          const displayName = caregiver.shortName || caregiver.name;
          const groupInfo = caregiver.group ? ` (${caregiver.group})` : '';
          select.append(`<option value="${caregiver.id}">${displayName}${groupInfo}</option>`);
        });
      }
      
      // 初始化分组下拉框
      function initCaregiverGroupSelect() {
        const select = $('#caregiverGroup');
        select.empty();
        select.append('<option value="">全部护理员</option>');
        caregiverGroups.forEach(group => {
          select.append(`<option value="${group.name}">${group.name}</option>`);
        });
      }

      // 绑定事件
      $('#dailyDispatchDate, #caregiverGroup').change(function() {
        renderDailyDispatch();
      });

      $('#monthlyDispatchMonth').change(function() {
        renderMonthlyDispatch();
      });

      // 初始化
      const today = new Date();
      $('#dailyDispatchDate').val(today.toISOString().split('T')[0]);
      $('#monthlyDispatchMonth').val(today.toISOString().substring(0, 7));
      
      initCaregiverGroupSelect();
      renderDailyDispatch();
      renderMonthlyDispatch();
      
      // 分组选择变化时重新渲染
      $('#caregiverGroup').change(function() {
        renderDailyDispatch();
      });

      // 通用刷新按钮
      $('#refreshBtn').click(function() {
        showPrompt('刷新提示', '数据已刷新完成！');
      });

      // 筛选按钮 - 根据当前激活的看板切换筛选内容
      $('#filterBtn').click(function() {
        const activeTab = $('.nav-link.active').attr('id');
        let filterHtml = '';

        if (activeTab === 'object-tab') {
          // 服务对象看板筛选
          filterHtml = `
            <div class="filter-group">
              <label>服务状态</label>
              <div class="filter-options">
                <div class="filter-option">
                  <input type="checkbox" id="filterNormal" checked>
                  <label for="filterNormal">正常</label>
                </div>
                <div class="filter-option">
                  <input type="checkbox" id="filterPause" checked>
                  <label for="filterPause">暂停</label>
                </div>
                <div class="filter-option">
                  <input type="checkbox" id="filterDeath">
                  <label for="filterDeath">死亡</label>
                </div>
                <div class="filter-option">
                  <input type="checkbox" id="filterTransfer">
                  <label for="filterTransfer">转出</label>
                </div>
              </div>
            </div>
            <div class="filter-group">
              <label>失能等级</label>
              <div class="filter-options">
                <div class="filter-option">
                  <input type="checkbox" id="filterLight" checked>
                  <label for="filterLight">轻度</label>
                </div>
                <div class="filter-option">
                  <input type="checkbox" id="filterMedium" checked>
                  <label for="filterMedium">中度</label>
                </div>
                <div class="filter-option">
                  <input type="checkbox" id="filterHeavy" checked>
                  <label for="filterHeavy">重度</label>
                </div>
              </div>
            </div>
            <div class="filter-group">
              <label>行政区域</label>
              <select class="form-select">
                <option value="all">全部区域</option>
                <option value="yuecheng">越城区</option>
                <option value="keqiao">柯桥区</option>
                <option value="shangyu">上虞区</option>
              </select>
            </div>
          `;
        } else if (activeTab === 'caregiver-tab') {
          // 护理员看板筛选
          filterHtml = `
            <div class="filter-group">
              <label>护理员姓名</label>
              <input type="text" class="form-control" placeholder="输入姓名模糊搜索">
            </div>
            <div class="filter-group">
              <label>服务完成率</label>
              <div class="filter-options">
                <div class="filter-option">
                  <input type="radio" name="completionRate" id="rateAll" checked>
                  <label for="rateAll">全部</label>
                </div>
                <div class="filter-option">
                  <input type="radio" name="completionRate" id="rateHigh">
                  <label for="rateHigh">≥90%</label>
                </div>
                <div class="filter-option">
                  <input type="radio" name="completionRate" id="rateMid">
                  <label for="rateMid">70%-90%</label>
                </div>
                <div class="filter-option">
                  <input type="radio" name="completionRate" id="rateLow">
                  <label for="rateLow"><70%</label>
                </div>
              </div>
            </div>
          `;
        } else if (activeTab === 'operation-tab') {
          // 运营总体看板筛选
          filterHtml = `
            <div class="filter-group">
              <label>区域类型</label>
              <div class="filter-options">
                <div class="filter-option">
                  <input type="radio" name="regionType" id="regionAll" checked>
                  <label for="regionAll">全部区域</label>
                </div>
                <div class="filter-option">
                  <input type="radio" name="regionType" id="regionNormal">
                  <label for="regionNormal">普通区域</label>
                </div>
                <div class="filter-option">
                  <input type="radio" name="regionType" id="regionFocus">
                  <label for="regionFocus">特别关注区域</label>
                </div>
              </div>
            </div>
            <div class="filter-group">
              <label>完成率筛选</label>
              <select class="form-select">
                <option value="all">全部</option>
                <option value="gt80">≥80%</option>
                <option value="lt80"><80%</option>
              </select>
            </div>
          `;
        }

        $('#filterModalBody').html(filterHtml);
        filterModal.show();
      });

      // 确认筛选按钮
      $('#confirmFilterBtn').click(function() {
        filterModal.hide();
        showPrompt('筛选提示', '筛选条件已应用！');
        // 实际项目中此处调用筛选接口更新数据
      });

      // 护理员展开/收起按钮
      $('.expand-btn').click(function() {
        const id = $(this).data('id');
        const detail = $(`#caregiverDetail${id}`);
        if (detail.hasClass('show')) {
          detail.removeClass('show');
          $(this).text('展开');
        } else {
          detail.addClass('show');
          $(this).text('收起');
        }
      });

      // 服务对象/护理员/区域项点击事件（模拟跳转）
      $('.obj-item, .caregiver-item, .region-item').click(function() {
        const id = $(this).data('id');
        // 实际项目中此处跳转详情页
        console.log(`点击了ID为${id}的项，跳转详情页`);
      });

      // 显示提示信息
      function showPrompt(title, msg) {
        $('#promptTitle').text(title);
        $('#promptMsg').text(msg);
        promptModal.show();
      }

      // 标签页切换时更新页面标题
      $('#kanbanTabs button').click(function() {
        const tabName = $(this).text();
        $('.page-title').text(`看板管理 - ${tabName}`);
      });

      // ========== 服务对象详情和档案功能 ==========
      const objectDetailModal = new bootstrap.Modal('#objectDetailModal');
      
      // 生成服务对象档案HTML
      function generateObjectArchiveHtml(objId) {
        // 根据client_file_stru表，按position分组显示档案
        const initialFiles = [
          { name: '本人身份证', pageNum: 2, optional: false, yangNeed: false },
          { name: '代理人身份证', pageNum: 2, optional: true, yangNeed: false },
          { name: '失能等级自评表', pageNum: 1, optional: false, yangNeed: false },
          { name: '评估申请表', pageNum: 2, optional: false, yangNeed: false },
          { name: '病情承诺书', pageNum: 1, optional: false, yangNeed: false },
          { name: '病例或证明', pageNum: 0, optional: false, yangNeed: true }
        ];
        
        const publicFiles = [
          { name: '服务协议', pageNum: 0, optional: false, yangNeed: false },
          { name: '评估结论书', pageNum: 1, optional: false, yangNeed: false },
          { name: '中止服务协议', pageNum: 1, optional: false, yangNeed: false },
          { name: '转出申请', pageNum: 1, optional: false, yangNeed: false },
          { name: '死亡证明', pageNum: 1, optional: false, yangNeed: false }
        ];
        
        const contractFiles = [
          { name: '服务计划', pageNum: 0, optional: false, yangNeed: false, saveType: 2 },
          { name: '服务记录', pageNum: 0, optional: false, yangNeed: false, saveType: 2 },
          { name: '转入申请', pageNum: 1, optional: false, yangNeed: false, saveType: 3 }
        ];
        
        return `
          <div class="mb-4 mt-3">
            <h6><i class="fa fa-file-text"></i> 初评材料 (position=1)</h6>
            <div class="archive-files">
              ${initialFiles.map(file => `
                <div class="archive-file-item">
                  <img src="https://via.placeholder.com/150x120?text=${encodeURIComponent(file.name)}" alt="${file.name}">
                  <div class="file-name">${file.name}${file.pageNum > 0 ? ` (${file.pageNum}页)` : ''}${file.optional ? ' [可选]' : ''}${file.yangNeed ? ' [60岁以下]' : ''}</div>
                </div>
              `).join('')}
            </div>
          </div>
          <div class="mb-4">
            <h6><i class="fa fa-file-text"></i> 公示后材料 (position=2)</h6>
            <div class="archive-files">
              ${publicFiles.map(file => `
                <div class="archive-file-item">
                  <img src="https://via.placeholder.com/150x120?text=${encodeURIComponent(file.name)}" alt="${file.name}">
                  <div class="file-name">${file.name}${file.pageNum > 0 ? ` (${file.pageNum}页)` : ''}</div>
                </div>
              `).join('')}
            </div>
          </div>
          <div class="mb-4">
            <h6><i class="fa fa-file-text"></i> 签约后材料 (position=3)</h6>
            <div class="archive-files">
              ${contractFiles.map(file => `
                <div class="archive-file-item">
                  <img src="https://via.placeholder.com/150x120?text=${encodeURIComponent(file.name)}" alt="${file.name}">
                  <div class="file-name">${file.name}${file.saveType === 2 ? ' [每月一份]' : file.saveType === 3 ? ' [记录日期]' : ''}</div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }
      
      // 获取区域名称
      function getRegionName(region) {
        const regionMap = {
          'yuecheng': '越城区',
          'keqiao': '柯桥区',
          'shangyu': '上虞区',
          'zhuji': '诸暨市',
          'shengzhou': '嵊州市',
          'xinchang': '新昌县'
        };
        return regionMap[region] || region;
      }

      // ========== 护理员详情和档案功能 ==========
      const caregiverDetailModal = new bootstrap.Modal('#caregiverDetailModal');
      
      // 生成护理员档案HTML
      function generateCaregiverArchiveHtml(caregiverId) {
        // 根据nurse_file_stru表显示档案
        const archiveFiles = [
          { name: '身份证', pageNum: 2 },
          { name: '职业技能证书', pageNum: 1 },
          { name: '服务合同', pageNum: 0 }
        ];
        
        return `
          <div class="mb-4 mt-3">
            <h6><i class="fa fa-file-text"></i> 身份证</h6>
            <div class="archive-files">
              <div class="archive-file-item">
                <img src="https://via.placeholder.com/150x120?text=身份证正面" alt="身份证正面">
                <div class="file-name">身份证正面.jpg</div>
              </div>
              <div class="archive-file-item">
                <img src="https://via.placeholder.com/150x120?text=身份证反面" alt="身份证反面">
                <div class="file-name">身份证反面.jpg</div>
              </div>
            </div>
          </div>
          <div class="mb-4">
            <h6><i class="fa fa-file-text"></i> 职业技能证书</h6>
            <div class="archive-files">
              <div class="archive-file-item">
                <img src="https://via.placeholder.com/150x120?text=证书" alt="证书">
                <div class="file-name">护理员证书.jpg</div>
              </div>
            </div>
          </div>
          <div class="mb-4">
            <h6><i class="fa fa-file-text"></i> 服务合同</h6>
            <div class="archive-files">
              <div class="archive-file-item">
                <img src="https://via.placeholder.com/150x120?text=合同" alt="合同">
                <div class="file-name">服务合同.pdf</div>
              </div>
            </div>
          </div>
        `;
      }

      // ========== 护理员设置相关功能 ==========
      const caregiverSettingsModal = new bootstrap.Modal('#caregiverSettingsModal');
      const editCaregiverModal = new bootstrap.Modal('#editCaregiverModal');
      
      // 打开护理员设置
      $('#caregiverSettingsLink').click(function(e) {
        e.preventDefault();
        renderCaregiverSettings();
        caregiverSettingsModal.show();
      });
      
      // 渲染护理员设置界面
      function renderCaregiverSettings() {
        // 渲染分组列表
        renderGroupList();
        
        // 渲染护理员列表
        renderCaregiverSettingsList();
        
        // 更新分组下拉框
        updateGroupSelect();
      }
      
      // 渲染分组列表
      function renderGroupList() {
        const container = $('#groupList');
        container.empty();
        
        if (caregiverGroups.length === 0) {
          container.html('<p class="text-muted">暂无分组，请添加分组</p>');
          return;
        }
        
        caregiverGroups.forEach((group, index) => {
          const groupDiv = $(`
            <div class="d-flex align-items-center gap-2 mb-2 p-2 border rounded">
              <span class="flex-grow-1">${group.name}</span>
              <button class="btn btn-sm btn-outline-danger delete-group-btn" data-index="${index}">删除</button>
            </div>
          `);
          container.append(groupDiv);
        });
        
        // 绑定删除分组事件
        $('.delete-group-btn').click(function() {
          const index = $(this).data('index');
          if (confirm('确定要删除该分组吗？该分组下的护理员将变为未分组状态。')) {
            const groupName = caregiverGroups[index].name;
            caregiverGroups.splice(index, 1);
            // 将该分组下的护理员设为未分组
            caregiverData.forEach(c => {
              if (c.group === groupName) {
                c.group = '';
                c.order = 0;
              }
            });
            renderCaregiverSettings();
            saveCaregiverSettings();
          }
        });
      }
      
      // 渲染护理员设置列表
      function renderCaregiverSettingsList() {
        const tbody = $('#caregiverSettingsList');
        tbody.empty();
        
        // 按分组和次序排序
        const sortedCaregivers = [...caregiverData].sort((a, b) => {
          if (a.group !== b.group) {
            if (!a.group) return 1;
            if (!b.group) return -1;
            return a.group.localeCompare(b.group);
          }
          return (a.order || 999) - (b.order || 999);
        });
        
        sortedCaregivers.forEach(caregiver => {
          const row = $(`
            <tr>
              <td>${caregiver.name}</td>
              <td>${caregiver.shortName || '-'}</td>
              <td>${caregiver.group || '未分组'}</td>
              <td>${caregiver.order || '-'}</td>
              <td>
                <button class="btn btn-sm btn-primary edit-caregiver-btn" data-id="${caregiver.id}">编辑</button>
              </td>
            </tr>
          `);
          tbody.append(row);
        });
        
        // 绑定编辑事件
        $('.edit-caregiver-btn').click(function() {
          const id = parseInt($(this).data('id'));
          const caregiver = caregiverData.find(c => c.id === id);
          if (caregiver) {
            $('#editCaregiverId').val(id);
            $('#editCaregiverName').val(caregiver.name);
            $('#editCaregiverShortName').val(caregiver.shortName || '');
            $('#editCaregiverGroup').val(caregiver.group || '');
            $('#editCaregiverOrder').val(caregiver.order || '');
            updateGroupSelect();
            editCaregiverModal.show();
          }
        });
      }
      
      // 更新分组下拉框
      function updateGroupSelect() {
        const select = $('#editCaregiverGroup');
        const currentValue = select.val();
        select.empty();
        select.append('<option value="">未分组</option>');
        caregiverGroups.forEach(group => {
          select.append(`<option value="${group.name}">${group.name}</option>`);
        });
        select.val(currentValue);
      }
      
      // 添加分组
      $('#addGroupBtn').click(function() {
        const groupName = $('#newGroupName').val().trim();
        if (!groupName) {
          alert('请输入分组名称');
          return;
        }
        if (caregiverGroups.find(g => g.name === groupName)) {
          alert('该分组已存在');
          return;
        }
        caregiverGroups.push({ name: groupName });
        $('#newGroupName').val('');
        renderCaregiverSettings();
        saveCaregiverSettings();
      });
      
      // 保存编辑的护理员设置
      $('#saveEditCaregiverBtn').click(function() {
        const id = parseInt($('#editCaregiverId').val());
        const caregiver = caregiverData.find(c => c.id === id);
        if (caregiver) {
          caregiver.shortName = $('#editCaregiverShortName').val().trim();
          caregiver.group = $('#editCaregiverGroup').val() || '';
          caregiver.order = parseInt($('#editCaregiverOrder').val()) || 0;
          saveCaregiverSettings();
          editCaregiverModal.hide();
          renderCaregiverSettings();
          showPrompt('保存成功', '护理员设置已保存');
        }
      });
      
      // 保存所有护理员设置
      $('#saveCaregiverSettingsBtn').click(function() {
        saveCaregiverSettings();
        caregiverSettingsModal.hide();
        showPrompt('保存成功', '所有设置已保存');
        // 刷新护理员看板和派单信息
        renderCaregiverTable();
        renderDailyDispatch();
      });

    });
  </script>
</body>
</html>